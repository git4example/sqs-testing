
aws sqs get-queue-attributes --queue-url 	https://sqs.ap-southeast-2.amazonaws.com/064250592128/SQS4ECS --attribute-names ApproximateNumberOfMessages

{
    "Attributes": {
        "ApproximateNumberOfMessages": "879"
    }
}

aws ecs describe-services --cluster CapacityProviderCluster  --service receive


aws application-autoscaling put-scaling-policy \
    --service-namespace ecs \
    --scalable-dimension ecs:service:DesiredCount \
    --resource-id service/CapacityProviderCluster/receive \
    --policy-name sqs-target-tracking-scaling-policy \
    --policy-type TargetTrackingScaling \
    --target-tracking-scaling-policy-configuration file://config.json


{
    "TargetValue":1.0,
    "CustomizedMetricSpecification":{
        "MetricName":"MySQSBacklogPerTask",
        "Namespace":"MySQSNamespace",
        "Statistic":"Average",
        "Unit":"Count"
    },
    "ScaleOutCooldown": 60,
    "ScaleInCooldown": 60
}


put metric every 1 min : 

    while sleep 60; do 

    aws cloudwatch put-metric-data --metric-name MySQSBacklogPerTask --namespace MySQSNamespace --unit None --value $(aws sqs get-queue-attributes --queue-url https://sqs.ap-southeast-2.amazonaws.com/064250592128/SQS4ECS --attribute-names ApproximateNumberOfMessages --query 'Attributes.ApproximateNumberOfMessages' --output text);

    done





ECSServiceAverageCPUUtilization

aws application-autoscaling delete-scaling-policy --policy-name web-app-cpu-lt-25 --scalable-dimension ecs:service:DesiredCount --resource-id service/default/web-app --service-namespace ecs